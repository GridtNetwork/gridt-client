<ion-header>
  <ion-toolbar >
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>
      Settings
    </ion-title>
  </ion-toolbar>
</ion-header>


<ion-content padding>
  <!-- Refreshes page if pulled down -->
  <ion-refresher slot="fixed" (ionRefresh)="refreshPage($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <!-- Error if no user data is received -->
  <ion-grid *ngIf="!(settings$ | async)">
    <ion-row justify-content-center>
      <ion-col size="12" size-sm="6" offset-sm="3" text-center>
        <p>Could not reach server. Pull down to try again.</p>
      </ion-col>
    </ion-row>
  </ion-grid>

  <ion-grid>
    <ion-row justify-content-center>
      <ion-col size="12" size-sm="8" offset-sm="2" size-md="6" offset-md="3" text-center>
        <ion-card  class="ion-text-center">
          <ion-card-header>
            <ion-avatar class="ion-text-center">
              <img [src]="gravatar">
            </ion-avatar>
            <ion-card-title>{{ (settings$ | async)?.identity.username }}</ion-card-title>
          </ion-card-header>

          <ion-card-content>
            <ion-list>
              <ion-item-group>
                <ion-item-divider>
                  <ion-label>
                    Bio
                  </ion-label>
                </ion-item-divider>

                <!-- <ion-item>
                  "No bio? I'm sure there's something to tell about yourself!"
                </ion-item> -->
                <form #bform="ngForm" (ngSubmit)="write_bio_change(bform)">
                  <ion-item lines="none">
                    <ion-textarea
                      #bio
                      ngModel
                      class="ion-padding"
                      autoGrow="true"
                      [readonly]="edit_bio$"
                      type = "text"
                      name = "bio"
                      [value]="(setings$ | async)?.identity.bio">
                    </ion-textarea>

                    <ion-button
                      *ngIf = "edit_bio$"
                      slot="end"
                      size="small"
                      [disabled]="( isDisabled$ | async )"
                      (click) = "change_bio()"
                    >edit</ion-button>
                    <ion-button
                      *ngIf="!edit_bio$"
                      type = "submit"
                      slot = "end"
                      size = "small"
                      [disabled] = "( isDisabled$ | async )"
                    >save</ion-button>
                  </ion-item>
                </form>
              </ion-item-group>

              <!-- <ion-item-group>
                <ion-item-divider>
                  <ion-label>
                    Recent messages
                  </ion-label>
                </ion-item-divider>

                <ion-item *ngIf="false">
                  "You have not sent any messages yet.."
                </ion-item>

                <ion-item lines="none">
                  <ion-note slot="start">
                    <ion-text color="secondary">
                      19-4-2020 <br>
                      20:00h
                    </ion-text>
                  </ion-note>

                  <ion-label class="ion-text-wrap">
                    <ion-text color="primary">
                      <h3>Movement Name</h3>
                    </ion-text>
                    <p>My awesome message.</p>
                  </ion-label>

                </ion-item>
              </ion-item-group> -->

              <ion-item-group>
                <ion-item-divider>
                  <ion-label>
                    Account settings
                  </ion-label>
                </ion-item-divider>

                <form #nform="ngForm" (ngSubmit)="Submit_name_change(nform)">
                  <ion-item type="reset">
                    <ion-label position="floating">
                      Display name
                    </ion-label>
                    <ion-input
                      #name
                      ngModel
                      type="text"
                      name="name"
                      [value]="(settings$ | async)?.identity.username"
                      [readonly]="edit_name$"
                    ></ion-input>
                    <ion-button
                      *ngIf="edit_name$"
                      slot = "end"
                      size = "small"
                      [disabled] = "( isDisabled$ | async )"
                      (click) = "change_name()"
                    >change</ion-button>
                    <ion-button
                      *ngIf="!edit_name$"
                      type = "submit"
                      slot = "end"
                      size = "small"
                      [disabled] = "( isDisabled$ | async )"
                    >save</ion-button>
                  </ion-item>
                </form>

                <form #eform="ngForm" (ngSubmit)="Submit_email_change(eform)">
                  <ion-item type="reset">
                    <ion-label position="floating">
                      E-mail address
                    </ion-label>
                    <ion-input
                      #email
                      ngModel
                      type="email"
                      name="email"
                      [value]="(settings$ | async)?.identity.email"
                      [readonly]="edit_email$"
                    ></ion-input>
                    <ion-button
                      *ngIf="edit_email$"
                      slot = "end"
                      size = "small"
                      [disabled] = "( isDisabled$ | async )"
                      (click) = "change_email()"
                    >change</ion-button>
                    <ion-button
                      *ngIf="!edit_email$"
                      type = "submit"
                      slot = "end"
                      size = "small"
                      [disabled] = "( isDisabled$ | async )"
                    >save</ion-button>
                  </ion-item>
                </form>

                <ion-item>
                  <ion-label position="floating">
                    Password
                  </ion-label>
                  <ion-input value="*************" readonly></ion-input>
                  <ion-button slot="end" size="small" [disabled]="( isDisabled$ | async )">change</ion-button>
                </ion-item>
              </ion-item-group>
<!--
              <ion-item-group>
                <ion-item-divider>
                  <ion-label>
                    Gridt settings
                  </ion-label>
                </ion-item-divider>

                <ion-item lines="none">
                  <ion-label>
                    Receive Gridt emails
                  </ion-label>
                  <ion-toggle disabled="true"></ion-toggle>
                </ion-item>

                <ion-item lines="none">
                  <ion-label>
                    Receive nudges
                  </ion-label>
                  <ion-toggle disabled="true"></ion-toggle>
                </ion-item>

                <ion-item lines="none">
                  <ion-label>
                    Receive kudos
                  </ion-label>
                  <ion-toggle disabled="true"></ion-toggle>
                </ion-item>

                <ion-item lines="none">
                  <ion-label>
                    Use Gravatar for profile picture
                  </ion-label>
                  <ion-toggle disabled="true"></ion-toggle>
                </ion-item>

              </ion-item-group> -->

            </ion-list>
          </ion-card-content>
        </ion-card>

        <!-- <ion-card>
          <ion-card-header>
            <ion-card-title>Server</ion-card-title>
            <ion-card-subtitle>Change which server you're on</ion-card-subtitle>
          </ion-card-header>

          <ion-card-content>
            This option will become available in the future.
          </ion-card-content>
        </ion-card> -->
      </ion-col>
    </ion-row>
  </ion-grid>
</ion-content>
