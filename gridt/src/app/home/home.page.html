<ion-header>
  <ion-toolbar color="primary" mode="ios">
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>Home</ion-title>
  </ion-toolbar>
</ion-header>

<!-- If the user is not enrolled for any movements yet, inform his/her about how to do so-->
<ion-content paddinsearchTextg class="bg-style">
  <ion-grid *ngIf="movements$ && (movements$ | async).length === 0">
    <ion-row>
      <ion-col size="12" size-sm="8" offset-sm="2" text-center>
        <p>
          You haven't subscribed to any movements yet, let's do so now!
          <ion-icon name="bicycle-outline"></ion-icon>
          <ion-icon name="star"></ion-icon>
          Movements can be found below:
          <ion-button href="/movements" color="success" expand="full" shape="round">
            Click me!
          </ion-button>
        </p>
      </ion-col>
    </ion-row>
  </ion-grid>

  <!-- Can be rewritten as an if/else statement together with previous if-->
  <ion-grid *ngIf="movements$ && (movements$ | async).length > 0">
    <ion-row class="ion-justify-content-center">
      <ion-col offset-lg="auto">
        <ion-button (click)="showMenu()" class="filter" color="dark">
          <ion-icon name="filter-outline"></ion-icon>
        </ion-button>
        <p></p>
        <ion-button (click)="changeGrid()" class="grid" color="dark">
          <ion-icon [name]="iconName"></ion-icon>
        </ion-button>
      </ion-col>
    </ion-row>
    <ion-row class="ion-justify-content-center">
      <ion-col *ngFor="let movement of movements$ | async" offset-lg="auto" size-sm="12" size-md="6" size-lg="4">
        <!-- Create a list item for each movement the user is in. -->
         <ion-card  class="movement-card, sustain-content">
          <!-- Display the title on top -->
          <ion-card-header class="sustain-header">
            <ion-card-title class="ion-text-center">{{ movement.name }}</ion-card-title>
          </ion-card-header>

          <ion-card-content>
            <ion-grid>
              <ion-row *ngIf="readyToSignal(movement)">
                <ion-col>
                  <p>
                    Resets in: <b>x days</b>
                  </p>
                </ion-col>
              </ion-row>
             <ion-row>
                <ion-col *ngIf="iconName === 'grid-outline'" class="small-text" size="10">
                  <p *ngIf="readyToSignal(movement)">Have you accomplished your goal?</p>
                  <p *ngIf="!readyToSignal(movement)">Well done!</p>
                </ion-col>
                <ion-col *ngIf="iconName === 'list-outline'" class="ion-float-left" size="10">
                  <ion-icon name="image-outline" class="icon"></ion-icon>
                </ion-col>
                <ion-col size="2">
                  <ion-button class="accept-button" fill="clear" (click)="confirmSignal(movement)" [hidden]="!readyToSignal(movement)" [attr.disabled]="!readyToSignal(movement) ? '' : null">
                    <ion-icon slot="icon-only" name="stop-outline"></ion-icon>
                  </ion-button>
                  <ion-icon class="checkmark" color="success" name="checkmark-outline" [hidden]="readyToSignal(movement)"></ion-icon>
                </ion-col>
              </ion-row>
  
              <ion-row *ngIf="iconName === 'grid-outline'">
                <ion-list class="leader-list, ion-no-padding">
                  <ion-item *ngFor="let leader of movement.leaders" class="sustain-content">
                    <ion-avatar slot="start">
                      <img src="https://gravatar.com/avatar/{{ leader.avatar }}">
                    </ion-avatar>
                    <ion-label>
                      <div class="leader-container">
                        <h3>
                          {{ leader.username }}
                        </h3>
                        <p>{{ isLeaderDone(leader, movement) ? 'Done!' : 'Pending...' }}</p>
                      </div>
                      <small *ngIf="isLeaderDone(leader, movement) && leader.last_signal.message">
                        {{ leader.last_signal.message }}
                      </small>
                    </ion-label>
                    <ion-button
                        color="dark"
                        size="small" fill="clear"
                        [attr.disabled]="!canSwap(movement) ? '' : null"
                        (click)="confirmSwapLeader(movement, leader)"
                      >
                      <ion-icon slot="end" name="settings-outline"></ion-icon>
                    </ion-button>
                  </ion-item>
                </ion-list>
              </ion-row>
            </ion-grid>
          </ion-card-content>
        </ion-card>
    </ion-col>
  </ion-row>
  </ion-grid>

</ion-content>
